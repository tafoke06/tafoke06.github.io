<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Project 2</title>
<script src="https://code.jquery.com/jquery-latest.js" type="text/javascript">
</script>
<script type="text/javascript">
	//now what?
	//api:  http://www.ist.rit.edu/api/

    //getPost - get or post
    //d - {path:'/about/'}
    //idForSpinner - #parent (optional)
    //  the id of the container I want the spinner to go into
    //  use: xhr('get',{path:'/about/'}, '#id').done(function(){//code});
	function xhr(getPost, d, idForSpinner) {
        return $.ajax({
			type: getPost,
			dataType: 'json',
			data: d,
			cache: false,
			async: true,
            url: 'proxy.php',
			
			beforeSend: function() {
				$(idForSpinner).append('<img src="assets/media/gears.gif" class="spin" />');
			}
		}).always(function() {
			$(idForSpinner).find('.spin').fadeOut(500, function() {
				$(this).remove();
			});
		}).fail(function(err) {
			console.log('There was an AJAX error');
			console.log(err);
		});
	}
    
   //Retrieval util
   //function helps to find out which one I am to debug code
   function getAttributesByName(arr, name, val) {
       var result = null;
       $.each(arr, function() {
           if(this[name]===val) {
               result = this;
           }
       });
       return result;
   }
   
    
   function loadAbout(about) {
       $('#content').append('<h2>' + this.title + '<h2>');
       $('#content').append('<h3>' + this.description + '<h3>');
       $('#content').append('<h4>' + this.quote + '<h4>');
       $('#content').append('<h5>' + this.quoteAuthor + '<h5>'); 
   }
    
   function loadUngradDegrees(paper) {
       if(paper) {
          $.each(paper.undergraduate, function(i, item){
            console.log("UNDERGRADUATE"); //debug
            console.log(item); //debug
            $('#degrees').append('<h2>' + this.title + '<h2>');
            $('#degrees').append('<h3>' + this.description + '<h3>');
            $('#degrees').append('<h4>' + this.concentrations + '<h4>');
          });   
       }
   }
   
   function loadGradDegrees(paper) {
       if(paper) {
          $.each(paper.graduate, function(i, item){
            if(item.availableCertificates !== undefined) {
                $('#degrees').append('<h3>' + this.degreeName + '<h3>');
                $('#degrees').append('<h4>' + this.availableCertificates + '<h4>');
            }
            else {
                $('#degrees').append('<h2>' + this.title + '<h2>');
                $('#degrees').append('<h3>' + this.description + '<h3>');
                $('#degrees').append('<h4>' + this.concentrations + '<h4>');
            }
         });        
   }
    
   function loadMinors(minor) {
       $.each(minor.UgMinors, function(i, item){
            $('#minors').append('<h2>' + this.name + '<h2>');
            $('#minors').append('<h3>' + this.title + '<h3>');
            $('#minors').append('<h3>' + this.description + '<h3>');
            $('#minors').append('<h4>' + this.courses + '<h4>');
            $('#minors').append('<h4>' + this.note + '<h4>');
       });   
   }
   
   function loadEmployment(employ) {
       
   } 
    
   function loadPeople(people) {
       $.each(json.faculty, function(){
            x +='<div class="faculty" data-uname="' + this.username + '"data-type="faculty"><h5>' + this.name + '</h5><img style="max-width:150px" src="' + this.imagePath + '"/></div>'
       })
         
       $('#people').append(x);
       $('.faculty').on('click', function() {
          var me = getAttributesByName(json.faculty, 'username', $(this).attr('data-uname'));
          console.log(me);
       });
       
   }
    
   function loadResearch(research) {
       
   }
   
   function loadResources(resource) {
       
   }
    
   function loadNews(news) {
       if(news) {
          $.each(news.older, function(i, item){
            console.log("NEWS"); //debug
            console.log(item); //debug
            $('#news').append('<h2>' + this.title + '<h2>');
            $('#news').append('<h3>' + this.date + '<h3>');
            $('#news').append('<h3>' + this.description + '<h3>');
          });   
       }
   }
    
   function loadFooter(footer) {
       if(last) {
          $.each(last.social, function(i, item){
            console.log("FOOTER"); //debug
            console.log(item); //debug
            $('#footer').append('<h2>' + this.title + '<h2>');
            $('#footer').append('<h3>' + this.tweet + '<h3>');
            $('#footer').append('<h4>' + this.by + '<h4>');
            $('#footer').append('<h3>' + this.twitter + '<h3>');
            $('#footer').append('<h4>' + this.facebook + '<h4>');
          });
          $.each(last.quickLinks, function(i, item){
            console.log(item); //debug
            $('#footer').append('<h2>' + this.title + '<h2>');
            $('#footer').append('<h3>' + this.href + '<h3>');
          });
          $.each(last.copyright, function(i, item){
            console.log(item); //debug
            $('#footer').append('<h2>' + this.title + '<h2>');
            $('#footer').append('<h3>' + this.html + '<h3>');
            $('#footer').append('<h4>' + this.news + '<h4>');
          }); 
       }       
   } 

   //api:  www.ist.rit.edu/api/
   $(document).ready(function() {
     //get about
     //xhr('get', {path:'/about/'}, '#content').done(function(json){console.log(json.title);}); 
     xhr('get', {path:'/about/'}, '#content'), '#content').done(function(json){
         loadAbout(json);
     }); 
      
     //get undergraduate
     xhr('get', {path:'/degrees/undergraduate'}, '#degrees').done(function(json){
         loadUngradDegrees(json);
     });
     
     //get graduate   
     xhr('get', {path:'/degrees/graduate'}, '#degrees').done(function(json){
         loadGradDegrees(json);
     });   
       
     //get minor   
     xhr('get', {path:'/minors/'}, '#minors').done(function(json){
         loadMinors(json);
     });
       
    //get employment; use jquery tables
//     xhr('get', {path:'/people/'}, '#people').done(function(json){
//         loadPeople(json); 
//     });
       
    //get faculty; technically done
//     xhr('get', {path:'/people/'}, '#people').done(function(json){
//         loadPeople(json); 
//     });


    //get research
//     xhr('get', {path:'/people/'}, '#people').done(function(json){
//         loadResearch(json); 
//     });
       
       
    //get resources
//     xhr('get', {path:'/people/'}, '#people').done(function(json){
//         loadResources(json); 
//     });       
       
       
    //get news
     xhr('get', {path:'/people/'}, '#people').done(function(json){
         loadNews(json); 
     });       
       
       
    //get footer
     xhr('get', {path:'/footer/'}, '#footer').done(function(json){
         loadFooter(json); 
     });
       
     
   }); //end of .ready function
                     
                     
                     
</script>
</head>
<body>
  <h2>IST Dept Site</h2>
	<div id="content"></div>
    <div id="degrees"></div>
    <div id="minors"></div>
    <div id="employment"></div>
	<div id="people"></div>
    <div id="research"></div>
    <div id="resources"></div>
    <div id="news"></div>
    <div id="footer"></div>
</body>
</html>